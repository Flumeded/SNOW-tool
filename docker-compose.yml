services:
  snow-tracker:
    build: .
    container_name: snow-tracker
    expose:
      - "80"
    ports:
      - "8085:80"
    volumes:
      - snow_data:/app/data
    environment:
      - SECRET_KEY=${SECRET_KEY:-change-me-in-production}
      - ENABLE_NOTIFICATIONS=false
      - DATABASE_URL=sqlite:////app/data/snow_tracker.db
      - SLA_CRITICAL_THRESHOLD=${SLA_CRITICAL_THRESHOLD:-30}
      - SLA_WARNING_THRESHOLD=${SLA_WARNING_THRESHOLD:-120}
    restart: unless-stopped
    labels:
      # Traefik configuration
      - "traefik.enable=true"
      - "traefik.http.routers.snow-tracker.rule=Host(`snow.yourdomain.com`)"
      - "traefik.http.routers.snow-tracker.entrypoints=websecure"
      - "traefik.http.routers.snow-tracker.tls.certresolver=letsencrypt"
      - "traefik.http.services.snow-tracker.loadbalancer.server.port=80"
    networks:
      - proxy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  proxy:
    external: true

volumes:
  snow_data:
    driver: local
